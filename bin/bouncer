#!/usr/bin/env node

var Bouncer = require( '..' );
var chalk   = require( 'chalk' );
var debug   = require( 'debug' )( 'bin' );
var program = require( 'commander' );


function list( val ) {
  return val.split( ',' );
}

program
  .version( require( '../package.json' ).version )
  .option( '-a, --allowed-domains <allowed>', 'Comma separated list of allowed domains', list )
  .option( '-k, --key <key>', 'Set api key' )
  .option( '-l, --location <location>', 'Location of agent you want to run' )
  .option( '-r, --runs <runs>', 'Number of runs to evaluate loading times [ 1 ]' )
  .option( '-s, --server <server>', 'Webpagetest server you want to use [ www.webpagetest.org ]' )
  .option( '-u, --url <url>', 'Url you want to bounce' )
  .parse( process.argv );

if ( process.argv.length === 2 ) {
  program.help();
}

( new Bouncer( {
  allowedDomains : program.allowedDomains,
  key            : program.key,
  location       : program.location,
  runs           : program.runs,
  server         : program.server,
  url            : program.url
} ) ).run( function( err ) {
  if ( err ) {
    console.log( chalk.bgRed( err ) );
    process.exit( 1 );
  }

  console.log( chalk.bgGreen.white.bold( 'Bouncer finished!' ) );
  process.exit();
} );

